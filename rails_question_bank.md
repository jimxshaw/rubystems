# Rails Question Bank

## Rails Command Line

How do you create a Rails application called MyApp from the command line with a MySQL database?
- rails new my_app -d mysql

What's the shorthand for `rails generate`?
- rails g

You use singular PascalCase for Model generation.
- True, eg `rails generate model MyModel`

How do you add attributes and their datatype in Rails generate?
- rails generate model Product name:string

What option flag do you use to omit automatic timestamp attributes?
- rails generate model Product --no-timestamps

How do you autopopulate the migration change method?
- rails generate migration Add[something]To[SomeModel] qty_sold:integer

How do you add an index in the migration generation?
- rails generate migration Add[Attribute]To[SomeModel] <attr>:<type>:index
  
How do you add a foreign key in migration generation?
- rails generate migration Add[Attribute]To[SomeModel] <attr>:references
  
Generating a model creates four file types. What are they?
- Model, migration, model test, model fixture

Running `rails generate migration AddQtySoldToProducts qty_sold:integer` will create what single line of code in the #change method?
- add_column :products, :qty_sold, :integer ***
- add_column :qty_sold, :products, :integer
- add_column :products, qty_sold: :integer

On a generation command, what additional line of code is produced in your migration file when running `rails generate migration AddRefNumToProducts ref_num:string:index`?
- add_index :products, :ref_num

What single line of code is produced in your migration's #change method when running `rails generate migration AddStyleToProducts style:references`
- add_reference :products, :style, foreign_key: true

Before Rails version X.y.z, the same migration above would produce what code instead of the newer `add_reference`?
- don't know; need to look up

At what version did Rails introduce the #change method as the autogenerated code in migration files?
- dunno, need to look up

What methods are supported by the #change method?
- create_table, add_column, add_index, add_foreign_key, add_reference, add_timestamps
- also has: rename_table, rename_column, and rename_index
- also has: drop_table, remove_column, remove_index, remove_foreign_key, remove_reference, remove_timestamps

Which two methods require more info in #change to be reversible?
- drop_table and remove_column

Why wont this code work? `def change; remove_column :products, :qty_sold; end`
- running `rails db:migrate` won't know what datatype to put on the column when effectively migrating "up"

In a reversible code block, what is the conventional block variable?
- dir, as in reversible do |dir|; dir.up {}; dir.down{}; end;

Running `rails db:migrate` is just shorthand for what command?
- `rails db:migrate:up VERSION=[migration_id]`

Given the following output after running `rails db:migrate:status`:

| Status |  Migration ID   | Migration Name
| ------ | --------------- | -----------------------
|   up   |  20170918051411 | Create products
|   up   |  20170918051840 | Add qty sold to products
|   up   |  20170918052339 | Add ref num to products
|   up   |  20170918052723 | Add style to products
|  down  |  20170918061514 | Create styles
|  down  |  20170918061614 | Add foreign key to products

(cont'd from above), how would you only run the "Create styles" migration?
- `rails db:migrate:up VERSION=20170918061514`

How would you migrate down incrementally one migration_id at a time? Take the same table above, for example. What command could you use instead of `rails db:migrate:down VERSION=20170918052723`?
- `rails db:rollback`

How would you generate a migration to revert "Add style to products"?
- `rails generate migration RevertAddStyleToProducts`

There are two lines of code required in the revert migration file, one outside the migration class, and one inside the #change method. What would they be for the migration you just generated?
- `require_relative '20170918052723_add_style_to_products'` and `revert AddStyleToProducts`

In what Rails version did the shortcut `CreateJoinTable<TableA><TableB>` come into existence?
- dunno, look up

What's the full Rails generation for creating an inner join table migration?
- `rails generate migration CreateJoinTableTableATableB table_a table_b`

How can you suppress terminal output when running a migration?
- `rails db:migrate VERBOSE=false`

Which command looks at the database and dumps it into Ruby format for you to see?
- `rails db:schema:dump`

How would you load from the database into Rails the database schema in the SQL lang?
- `rails db:structure:dump`

What file is created from structure dump?
- `structure.sql`

If you manually delete your schema.rb file, which two commands will regenerate it?
- `rails db:migrate` and `rails db:schema:dump`

What command loads your sample data into your database?
- `rails db:seed`

## Rails CRUD

What's the alias for `#update_attribute()` and `#update_attributes()`?
- `#update`

How would you set attr values line by line?
- `product.attr = "value"`

How would you set attr values via hash?
- `product = Product.new(attr: "value", attr2: "value"); product.save`

How would you set attr values via block?
  ```ruby
  product = Product.create do |p|
    p.attr = "value"
    p.attr2 = "value"
  end
  ```

The `#update_attribute` method uses comma notation, right?
- `product.update_attribute(:attr, "value")`

The `#update_attributes` method uses hash notation, right?
- `product.update_attributes(attr: "value")`

What's the best way to update all attrs in a table?
- Use the `.update_all()` class method, like `Product.update_all(attr: "value")`

True or false: class methods will still run callbacks and validations.
- False

What is the best method to remove a record from the database?
- `product.destroy`

What's the difference between `#destroy` instance method and the `.destroy` class method?
- `.destroy` is called against the model class, eg `Product.destroy([:id])`

What method will destroy all records?
- `Product.destroy_all`

What's the difference between `.destroy` and `.delete`?
- `.delete` doesn't run callbacks or validations. Just executes SQL.

How do you manually update a record's "updated_at" value?
- `@product.touch`; useful for child objects, like upload an image and touch the associated record; good for callbacks

What is the default attribute that `product.touch` will update?
- updated_at

How would you `touch` a different attribute?
- `product.touch(:attr)`

How do you toggle a boolean attribute?
- `product.toggle(:attr)`

Does `#toggle` persist changes to the database?
- False

How would you persist a toggle?
- `product.toggle!(:attr)`

How would you increment an attribute of type integer? Instead of @p.attr = @p.attr + 1
- `@p.increment(:attr, 1)` or leave off the 1 for default "by 1"

How would you increment and persist to database?
- Use the bang notation.

What's the opposite of `#increment`?
- `@p.decrement(:attr)`

Should you use #increment and #decrement for associated objects?
- False

What should you use instead for associated objects?
- Cache counter

## Dirty Objects

How would you check if an object has been changed?
- `product.changed?`

How would you list the changed attributes?
- `product.changed`

How would you list the changed attributes with their old and new value?
- `product.changes`

How would you just see the changed attributes with their old value before they were changed?
- `product.changed_attributes`

How would you filter by an attribute to determine if it has been changed?
- `product.name_changed?`

How would you filter by an attribute and see its old and new value?
- `product.name_change`

If `product.name` gets the current value, what command gets the changed value for attribute, :name?
- `product.name_was`

How can you check if an attribute's value was changed from a specific old value?
- `product.name_changed?(from: "old_value")` # => bool

How can you check if an attribute's value was changed to a specific value?
- `product.name_changed?(to: "new_value")` # => bool

How can you check the above two changes?
- `product.name_changed?(from: "old_value", to: "new_value")`

What's the Rails helper method equivalent to `product.name = product.name_was`?
- `product.restore_attributes`

Will `product.restore_attributes` work after a record has been saved to the database?
- false

How can you see what was in the databases before, and what's there now?
- `product.previous_changes`

## Query Interface

What is the Rails helper equivalent to `Product.where(attr: "value").first`?
- `Product.find_by(attr: "value")`

Something about `Product.find_by_<attr>`

If a record isn't found, how would you initialize or create it in one method?
- `find_or_initialize_by` and `find_or_create_by`
  - works best with simple objects
  
Will `Product.find_by(attr: 'Value')` return the same thing as `Product.find_by(attr: 'value')?`
- true

How would you check to see if a record exists?
- `Product.exists?(attr: 'value')`

Can you use exists? to check if a conditional value?
- false

How would you check if a single conditional value exists?
- `Product.where(:attr > 100).any?` returns true if single record matches

How would you check if two or more records match some condition?
- `Product.where(:attr > 100).many?` true if > 2

Which part of this database call is the scope? `Product.recent.select(:name, :id)`
- `.recent`

What parameters does the `.select` method take?
- attributes

What datatype does `.select` return?
- an array of objects

What datatype does `.pluck(:id)` return?
- an array of attribute id values

What datatype does `.pluck(:id, :name)` return?
- an array of arrays containing id and name values

The `.ids` method is short for what?
- `Product.pluck(:id)`

To run a negative query, what method does `.not` always follow?
- `.where`

How would you perform a negative query before `.not` was introduced to Rails?
- `Product.where("name != ?", "Couch")`

What type of parameter does the `.or` method accept?
- ActiveRelation (query or scope)

Can you scope a different model using `.or`?
- false

Can you call other methods besides `.where` and `.having` using `.or`?
- false

When dealing with a large record set, what is the term to process them set by set?
- batching

If `Product.all.each {...}` returns all records and operates on them, what is the equivalent approach in batches?
- `Product.find_each {...}`

What is the default record set size for the `.find_each` method?
- 1000

How can you specify the batch size and range?
- `Product.find_each(batch_size: 100, start: 500, finish: 1000) {...}`

If `.find_each` yields each object to the block, what does `.find_in_batches` yield to the block?
- The batch itself as an array

In what version was `.in_batches` introduced?
- Rails 5

What does `.in_batches` yield to its code block?
- The batch itself as an ActiveRecord::Relation

If the named scope `scope :active, lambda { where(active: true) }` allows `User.active.all`, how would you define a default (unnamed) scope so that `User.all` produces the same outcome?
- `default_scope { where(active: true) }`

How would you bypass the default scope?
- `User.unscoped.all`

How would you remove the "where" clause from an Active Record statement?
- `Product.unscope(:where).all`

What is the synonym for `.unscope`?
- `.except`

What is the opposite of `.except`?
- `.only`

If `products = Product.where(price: 100..200)`, how could you change the where clause in `products`?
- `products.rewhere(price: 100)`

The clause `.where` is to `.rewhere`, as `.order` is to:
- `.reorder`

How can you reverse an order clause?
- `.reverse_order`

What data type must you be careful with using `.rewhere`?
- String

How do you query an inner join in Active Record for a Category that has many Products?
- `Category.join(:products).all`

What's the equivalent inverse of the above?
- `Product.join(:category).all`

How would you select all products with a category whose attribute `:name` has a value of "Furniture"?
- `products = Product.join(:category).where(categories: { name: "Furniture" })`

What would be the equivalent broken into two statements, given the first being `category = Category.find_by_name("Furniture")`?
- `products = Product.where(category_id: category.id)`

