# Rails Question Bank

## Rails Command Line

How do you create a Rails application called MyApp from the command line with a MySQL database?
- rails new my_app -d mysql

What's the shorthand for `rails generate`?
- rails g

You use singular PascalCase for Model generation.
- True, eg `rails generate model MyModel`

How do you add attributes and their datatype in Rails generate?
- rails generate model Product name:string

What option flag do you use to omit automatic timestamp attributes?
- rails generate model Product --no-timestamps

How do you autopopulate the migration change method?
- rails generate migration Add[something]To[SomeModel] qty_sold:integer

How do you add an index in the migration generation?
- rails generate migration Add[Attribute]To[SomeModel] <attr>:<type>:index
  
How do you add a foreign key in migration generation?
- rails generate migration Add[Attribute]To[SomeModel] <attr>:references
  
Generating a model creates four file types. What are they?
- Model, migration, model test, model fixture

Running `rails generate migration AddQtySoldToProducts qty_sold:integer` will create what single line of code in the #change method?
- add_column :products, :qty_sold, :integer ***
- add_column :qty_sold, :products, :integer
- add_column :products, qty_sold: :integer

On a generation command, what additional line of code is produced in your migration file when running `rails generate migration AddRefNumToProducts ref_num:string:index`?
- add_index :products, :ref_num

What single line of code is produced in your migration's #change method when running `rails generate migration AddStyleToProducts style:references`
- add_reference :products, :style, foreign_key: true

Before Rails version X.y.z, the same migration above would produce what code instead of the newer `add_reference`?
- don't know; need to look up

At what version did Rails introduce the #change method as the autogenerated code in migration files?
- dunno, need to look up

What methods are supported by the #change method?
- create_table, add_column, add_index, add_foreign_key, add_reference, add_timestamps
- also has: rename_table, rename_column, and rename_index
- also has: drop_table, remove_column, remove_index, remove_foreign_key, remove_reference, remove_timestamps

Which two methods require more info in #change to be reversible?
- drop_table and remove_column

Why wont this code work? `def change; remove_column :products, :qty_sold; end`
- running `rails db:migrate` won't know what datatype to put on the column when effectively migrating "up"

In a reversible code block, what is the conventional block variable?
- dir, as in reversible do |dir|; dir.up {}; dir.down{}; end;

Running `rails db:migrate` is just shorthand for what command?
- `rails db:migrate:up VERSION=[migration_id]`

Given the following output after running `rails db:migrate:status`:

| Status |  Migration ID   | Migration Name
| ------ | --------------- | -----------------------
|   up   |  20170918051411 | Create products
|   up   |  20170918051840 | Add qty sold to products
|   up   |  20170918052339 | Add ref num to products
|   up   |  20170918052723 | Add style to products
|  down  |  20170918061514 | Create styles
|  down  |  20170918061614 | Add foreign key to products

(cont'd from above), how would you only run the "Create styles" migration?
- `rails db:migrate:up VERSION=20170918061514`

How would you migrate down incrementally one migration_id at a time? Take the same table above, for example. What command could you use instead of `rails db:migrate:down VERSION=20170918052723`?
- `rails db:rollback`

How would you generate a migration to revert "Add style to products"?
- `rails generate migration RevertAddStyleToProducts`

There are two lines of code required in the revert migration file, one outside the migration class, and one inside the #change method. What would they be for the migration you just generated?
- `require_relative '20170918052723_add_style_to_products'` and `revert AddStyleToProducts`

In what Rails version did the shortcut `CreateJoinTable<TableA><TableB>` come into existence?
- dunno, look up

What's the full Rails generation for creating an inner join table migration?
- `rails generate migration CreateJoinTableTableATableB table_a table_b`

How can you suppress terminal output when running a migration?
- `rails db:migrate VERBOSE=false`

Which command looks at the database and dumps it into Ruby format for you to see?
- `rails db:schema:dump`

How would you load from the database into Rails the database schema in the SQL lang?
- `rails db:structure:dump`

What file is created from structure dump?
- `structure.sql`

If you manually delete your schema.rb file, which two commands will regenerate it?
- `rails db:migrate` and `rails db:schema:dump`

What command loads your sample data into your database?
- `rails db:seed`

## Rails CRUD

What's the alias for `#update_attribute()` and `#update_attributes()`?
- `#update`

How would you set attr values line by line?
- `product.attr = "value"`

How would you set attr values via hash?
- `product = Product.new(attr: "value", attr2: "value"); product.save`

How would you set attr values via block?
  ```ruby
  product = Product.create do |p|
    p.attr = "value"
    p.attr2 = "value"
  end
  ```

The `#update_attribute` method uses comma notation, right?
- `product.update_attribute(:attr, "value")`

The `#update_attributes` method uses hash notation, right?
- `product.update_attributes(attr: "value")`

What's the best way to update all attrs in a table?
- Use the `.update_all()` class method, like `Product.update_all(attr: "value")`

True or false: class methods will still run callbacks and validations.
- False

What is the best method to remove a record from the database?
- `product.destroy`

What's the difference between `#destroy` instance method and the `.destroy` class method?
- `.destroy` is called against the model class, eg `Product.destroy([:id])`

What method will destroy all records?
- `Product.destroy_all`

What's the difference between `.destroy` and `.delete`?
- `.delete` doesn't run callbacks or validations. Just executes SQL.

How do you manually update a record's "updated_at" value?
- `@product.touch`; useful for child objects, like upload an image and touch the associated record; good for callbacks

What is the default attribute that `product.touch` will update?
- updated_at

How would you `touch` a different attribute?
- `product.touch(:attr)`

How do you toggle a boolean attribute?
- `product.toggle(:attr)`

Does `#toggle` persist changes to the database?
- False

How would you persist a toggle?
- `product.toggle!(:attr)`

How would you increment an attribute of type integer? Instead of @p.attr = @p.attr + 1
- `@p.increment(:attr, 1)` or leave off the 1 for default "by 1"

How would you increment and persist to database?
- Use the bang notation.

What's the opposite of `#increment`?
- `@p.decrement(:attr)`

Should you use #increment and #decrement for associated objects?
- False

What should you use instead for associated objects?
- Cache counter

## Dirty Objects

How would you check if an object has been changed?
- `product.changed?`

How would you list the changed attributes?
- `product.changed`

How would you list the changed attributes with their old and new value?
- `product.changes`

How would you just see the changed attributes with their old value before they were changed?
- `product.changed_attributes`

How would you filter by an attribute to determine if it has been changed?
- `product.name_changed?`

How would you filter by an attribute and see its old and new value?
- `product.name_change`

If `product.name` gets the current value, what command gets the changed value for attribute, :name?
- `product.name_was`

How can you check if an attribute's value was changed from a specific old value?
- `product.name_changed?(from: "old_value")` # => bool

How can you check if an attribute's value was changed to a specific value?
- `product.name_changed?(to: "new_value")` # => bool

How can you check the above two changes?
- `product.name_changed?(from: "old_value", to: "new_value")`

What's the Rails helper method equivalent to `product.name = product.name_was`?
- `product.restore_attributes`

Will `product.restore_attributes` work after a record has been saved to the database?
- false

How can you see what was in the databases before, and what's there now?
- `product.previous_changes`

## Query Interface

What is the Rails helper equivalent to `Product.where(attr: "value").first`?
- `Product.find_by(attr: "value")`

Something about `Product.find_by_<attr>`

If a record isn't found, how would you initialize or create it in one method?
- `find_or_initialize_by` and `find_or_create_by`
  - works best with simple objects
  
Will `Product.find_by(attr: 'Value')` return the same thing as `Product.find_by(attr: 'value')?`
- true

How would you check to see if a record exists?
- `Product.exists?(attr: 'value')`

Can you use exists? to check if a conditional value?
- false

How would you check if a single conditional value exists?
- `Product.where(:attr > 100).any?` returns true if single record matches

How would you check if two or more records match some condition?
- `Product.where(:attr > 100).many?` true if > 2

Which part of this database call is the scope? `Product.recent.select(:name, :id)`
- `.recent`

What parameters does the `.select` method take?
- attributes

What datatype does `.select` return?
- an array of objects

What datatype does `.pluck(:id)` return?
- an array of attribute id values

What datatype does `.pluck(:id, :name)` return?
- an array of arrays containing id and name values

The `.ids` method is short for what?
- `Product.pluck(:id)`

To run a negative query, what method does `.not` always follow?
- `.where`

How would you perform a negative query before `.not` was introduced to Rails?
- `Product.where("name != ?", "Couch")`

What type of parameter does the `.or` method accept?
- ActiveRelation (query or scope)

Can you scope a different model using `.or`?
- false

Can you call other methods besides `.where` and `.having` using `.or`?
- false

When dealing with a large record set, what is the term to process them set by set?
- batching

If `Product.all.each {...}` returns all records and operates on them, what is the equivalent approach in batches?
- `Product.find_each {...}`

What is the default record set size for the `.find_each` method?
- 1000

How can you specify the batch size and range?
- `Product.find_each(batch_size: 100, start: 500, finish: 1000) {...}`

If `.find_each` yields each object to the block, what does `.find_in_batches` yield to the block?
- The batch itself as an array

In what version was `.in_batches` introduced?
- Rails 5

What does `.in_batches` yield to its code block?
- The batch itself as an ActiveRecord::Relation

If the named scope `scope :active, lambda { where(active: true) }` allows `User.active.all`, how would you define a default (unnamed) scope so that `User.all` produces the same outcome?
- `default_scope { where(active: true) }`

How would you bypass the default scope?
- `User.unscoped.all`

How would you remove the "where" clause from an Active Record statement?
- `Product.unscope(:where).all`

What is the synonym for `.unscope`?
- `.except`

What is the opposite of `.except`?
- `.only`

If `products = Product.where(price: 100..200)`, how could you change the where clause in `products`?
- `products.rewhere(price: 100)`

The clause `.where` is to `.rewhere`, as `.order` is to:
- `.reorder`

How can you reverse an order clause?
- `.reverse_order`

What data type must you be careful with using `.rewhere`?
- String

How do you query an inner join in Active Record for a Category that has many Products?
- `Category.join(:products).all`

What's the equivalent inverse of the above?
- `Product.join(:category).all`

How would you select all products with a category whose attribute `:name` has a value of "Furniture"?
- `products = Product.join(:category).where(categories: { name: "Furniture" })`

What would be the equivalent broken into two statements, given the first being `category = Category.find_by_name("Furniture")`?
- `products = Product.where(category_id: category.id)`

How would you only show distinct values given duplication from an inner join?
- `Category.joins(:products).distinct.pluck(:name)`

What's the synonym or alias for the `.distinct` method?
- `.uniq`

The `.distinct` method can be called anywhere in the statement except for which position?
- the last position

How would you include records in a join where the "right" table doesn't have a related "left" record?
- left outer join

How do you preload data in an Active Record query?
- `.includes()`

What method should you use when combining `.includes().where()`?
- `.references(:some_model)`

## Delegations

Given that a product has many SKUs, if a user purchases a SKU (type of product with different attrs), how would you define a way to call `sku.price`?
- `class Sku < ActiveRecord::Base; belongs_to :product; def price; product.price; end...`

How would you use "delegations" to accomplish the same code in the Sku model?
- `delegate :price, to: :product`

Given the above, what is the shorter way of calling `sku.product.price`?
- `sku.price`

What if you need to delegate more attributes. How would you define that delegation?
- `delegate [:price, :launched_at, :discontinued_at], to: :product`

Do the Product attributes need to be defined in the database?
- No, delegation can work on pure, non-database-connected attributes.

How do you call a delegation, given that `product = Product.first`?
- `product.prefix`

What SQL statement is executed by the above statement?
- `SELECT  `categories`.* FROM `categories` WHERE `categories`.`id` = 1 LIMIT 1`

How would you set a prefix so that calls are more human readable?
- `delegate :number, to: :product, prefix: true`

How would you call to get the sku number?
- `sku.product_number`

In the event that both the Product and the Sku model have a `number` attribute, how would you distinguish between the two given that you use delegation on number?
- Use the `prefix: true` option in your delegation

How would you customize your prefix to not use the default parent Model?
- `delegate :number, to: :product, prefix: 'style'`

How would you call the Sku number given the customized prefix?
- `sku.style_number`

How would you handle a delegation where the child instance hasn't been assigned a parent?
- `delegate :number, to: :product, allow_nil: true`

## Callbacks

| Create | Update | Destroy
| ------ | ------ | -------
| before_validation | before_validation | 
| VAL | IDA | TION
| after_validation | after_validation | 
| before_save | before_save |
| before_create | before_update | before_destroy
| DATA | BASE INTER | ACTION
| after_create | after_update | after_destroy
| after_save | after_save | 
| after_commit | after_commit | after_commit

What is a common reason to use a callback method?
- to set default values
- update other records
- perform cleanup or housekeeping tasks
- send an email or an API call

True of false: indenting private methods is a Ruby common practice?
- true

If the private method definition is the callback method, what is the public `before_validation ...` called?
- callback registration method

What does Proc stand for?
- Process

How would you call a callback method conditionally?
- `before_validation :add_default_prefix, if: Proc.new { |model| model.prefix.blank? }`

How do you define code to execute before and after an action?
- around

What must your method include for an "around" callback to work?
- `yield`

What are the four "around" callbacks?
- `around_save`
- `around_create`
- `around_update`
- `around_destroy`

Does the following method work with `around_save :say_whats_happening`?
```ruby
def say_whats_happening
  puts "before save"
  yield
  puts "after save"
end
```
- true

What are some other callbacks?
- `after_initialize`
- `after_find`
- `after_touch`
- `after_rollback`

Which methods will skip, or ignore, callbacks?
- `update_all`, `update`, and `delete_all`
- `increment` and `decrement`
- `toggle`
- `touch`

## Associations

What are the five associations in Active Record models?
- `has_one`
- `has_many`
- `belongs_to`
- `has_and_belongs_to_many`
- `has_many, :through`

What are the two most commonly used associations?
- `has_many` and `belongs_to`

Which side of the association contains the foreign key?
- `belongs_to`

If a Category class `has_many :products`, how would you explicitly define the class name and foreign key in the Product class?
- `belongs_to :category, class_name: 'Category', foreign_key: 'category_id'`

How would you scope an assocition?
- `has_many :products, lambda { order(:created_at) }`

How would you call this scoped association?
- `@category.products`

If a parent model has more than one child model, and the child models have an identical attribute name, how do you specify the child model you want to scope?
- `has_many :available_products, lambda { where('inventory > 0') }, class_name: 'Product'`

How would you tell Rails to destroy child records if a parent record is destroyed?
- `has_many :children, dependent: :destroy`

In what version did `dependent: :destroy` become standard? How would you define dependency in earlier versions?
- `:dependent => true`

Can you define the destroy dependency in the child model?
- true

What's the danger of defining dependent destroy in the child?
- deletes parent record, which could have other children, leaving them orphaned

If the `:destroy` action destroys associated objects, what is the action to delete just the database records?
- `:delete_all`

How can you set the foreign key values to NULL in the database (nil in the object)?
- `:nullify`

Do dependency definitions come before or after any scopes in the `has_many` registration?
- after

True or false: you can define `touch: true` on a `has_many` relationship?
- false

Given that `touch: true` is defined on a `belongs_to` relationship, what attribute does it touch?
- `updated_at`

How can you specify a different datetime attribute to be touched?
- `touch: :products_updated_at`

If you define a custom attribute to be touched, will it also touch the default attribute `updated_at`?
- true

Will `touch: true` also update the parent's `updated_at` attribute?
- true

Will `product.increment!(:inventory)` touch the record?
- false, increment bypasses callbacks

On with side of the parent/child association do you define `counter_cache: true`?
- `belongs_to`

True or false: the counter_cache is being stored in the child model?
- false

How do you add the child counter cache to the parent model?
- `rails generate migration AddProductsCountToCategories products_count:integer`

Is the counter cache stored in the database?
- false

How can you use counter cache?
- `category.products.size`

What method do you not want to call with counter cache because it queries the database?
- `category.products.count`

What method should you use in association with counter cache when removing records?
- `product.destroy`

How can you set the parent when instantiating a new child?
- `Product.create(category: category)`
- `category.products << Product.new(name: 'Cabinet')`
- `category.products.build(name: 'Cabinet')`

How can you set the parent when instantiating a new child?
- `category.products.create(name: 'Cabinet')`

How would you build on an association by calling the child first? Effectively setting the parent.
- `product.build_category(name: 'Kitchen')`

How would you build on an association and persist to database by calling the child first? Effectively setting the parent.
- `product.create_category(name: 'Kitchen')`

What is a self-referential association?
- a class with an association back to itself, eg a supervisor with subordinates, who can in turn, be a supervisor

What's an example of a self-referential association?
```ruby
class Employee < ActiveRecord::Base
  belongs_to :supervisor, class_name: 'Employee'
  has_many :subordinates, class_name: 'Employee', foreign_key: 'supervisor_id'
end
```

How do you suppress output to `nil` when executing a code block?
- `{...}; nil`

How is "single table inheritance" different from "self-referential association"?
- different classes allow for different behaviors

How do you define single table inheritance?
- add a column to the table that holds the name of the inherited class

How do you generate a migration to add single table inheritance?
- `rails generate migration AddTypeToProducts type:string`

How do you generate the model for single table inheritance without a migration?
- `rails generate model OnlineProducts --parent=Product`

How do you update the `type` attribute by referencing the model it belongs to?
- `product.update_attribute(:type, 'StoreProduct')` # not using hash notation

How do you know if polymorphic associations exist?
- one child model belongs_to several parent models

What are common uses for polymorphic associations?
- images, PDFs, comments

What problem does polymorphic associations solve?
- multiple foreign key columns on the child model that inherits from multiple parents

What's the naming convention for polymorphic associations?
- virtual_model-able

If you have a Document model, what two attributes will replace all the foreign keys?
- `:documentable_id` # integer
- `:documentable_type` # string

What is the migration shortcut for the above definitions?
- `t.references :documentable, polymorphic: true, index: true`

What term describes overusing single table inheritance and polymophic associations?
- "STI-Polymorphic sickness"

How do you define the child relationship in polymorphic association?
- `class Document; belongs_to :documentable, polymorphic: true`

How do you define the parent relationship in polymorphic associations?
- `class Product; has_many :documents, as: :documentable`
- `class PressRelease; has_many :documents, as: :documentable`
